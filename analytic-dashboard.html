<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="analytic-card.html">
<link rel="import" href="../solr-analytic/solr-analytic.html">


<core-style id="analytic-dashboard">
    section {
        overflow: auto;
    }

    .main section {
        background-color: #eee;
    }
    .card {
        background-color: white;
        box-sizing: border-box;
        width: 100%;
        z-index: 10000;
    }

    .wide.card {
        width: 90%;
        margin-top: 64px;
    }

    .wide .dashboard-bg {
    width: 512px;
    height: 512px;
    }

    .dashboard-bg > core-icon {
    position: absolute !important;
    }

    .main-button {
    position: absolute;
    top: 12px;
    left: 8px;
    fill: #424242;
    z-index: 10000;
    }

    .main-button.wide {
    position: fixed;
    top: 12px;
    left: 16px;
    fill: #424242;
    }

    .title {
    padding-left: 56px;
    font-size: 16px;
    }

    .wide .title {
    padding: 0;
    }

    .scroll {
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    }

    .wide > .main-button {
    top: 12px;
    left: 16px;
    }

    .main {
    position: relative;
    }

    .main::-webkit-scrollbar {
    display: none;
    }
</core-style>

<script>
    CoreStyle.g.columns = 2;
</script>

<!--
Element providing ..

##### Example

    <analytic-dashboard>
    </analytic-dashboard>

@element analytic-dashboard
@blurb Element providing ..
@status alpha
@url http://bhawke.github.io/analytic-dashboard

TODO: figure out how to bind where vals to target, look at <core-bind>
-->
<!--<polymer-element
        name="analytic-dashboard"
        on-analytic-item-selected="{{analyticItemSelected}}"
        attributes="dashboard selected wide" vertical layout>-->
<polymer-element
        name="analytic-dashboard"
        attributes="dashboard selected wide" vertical layout
        on-analytic-item-selected="{{analyticItemSelected}}">
    <template>
        <core-style ref="analytic-dashboard"></core-style>

        <link rel="stylesheet" href="dashboard-themes.css">



        <div class="{{dashboard.theme}}-theme theme-bg-a {{ {wide: wide} | tokenList }}" dummy fit layout vertical center center-justified hero-id="punch" hero>
            <div class="dashboard-bg" relative?="{{wide}}" flex?="{{!wide}}">

            </div>
        </div>

        <div class="main {{ {scroll: wide} | tokenList }}" flex center layout vertical hero-p>

            <div flex vertical layout slide-up-offscreen?="{{parentElement.selected === 'dashboard'}}"  cross-fade="{{!wide && parentElement.selected !== 'dashboard'}}" class="card {{ {wide: wide} | tokenList }}" relative>
                <core-toolbar class="{{dashboard.theme}}-theme theme-bg">
                    <div class="title">
                        <core-icon size="48" icon="drive-fusiontable" cross-fade-delayed?="{{parentElement.selected === 'dashboard'}}" cross-fade="{{parentElement.selected !== 'dashboard'}}"></core-icon>
                        {{dashboard.name}}
                    </div>
                </core-toolbar>
                <section flex horizontal wrap layout>
                    <content id="cards" select="analytic-card"></content>

                    <template repeat="{{analytic in dashboard.analytics}}">
                        <analytic-card analytic="{{analytic}}" global="{{dashboard.global}}" wide="{{wide}}"></analytic-card>
                    </template>
                </section>
            </div>

            <paper-icon-button class="main-button {{ {'theme-color': !wide, wide: wide} | tokenList }}" icon="arrow-back"  on-tap="{{mainAction}}" hero?="{{parentElement.selected === 'dashboards'}}" cross-fade-delayed?="{{parentElement.selected === 'dashboard'}}"></paper-icon-button>

        </div>


    </template>

    <script>
        Polymer('analytic-dashboard', {
            //selected: 'front',
            //selectedItem: null,
            wide: false,

            created: function() {
                this.g = CoreStyle.g;
            },
            wideChanged: function() {
                if (this.wide)
                    this.g.columns = 2;
                else
                    this.g.columns = 1;
            },
            /**
             * TODO: make it so we don't have to treat each scenario differently, unify model
             */
            analyticItemSelected : function(event, detail, sender) {
                if (!this.dashboard)
                    event.srcElement.target = detail.items[0].label;
            },
            mainAction: function() {
                this.fire('main');
            }

        });
    </script>
</polymer-element>